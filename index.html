document.getElementById('generate').addEventListener('click', function() {
  if (!excelData || excelData.length === 0) {
    alert("Por favor, carga un archivo válido primero.");
    return;
  }

  try {
    // Extraer datos del archivo
    const labels = excelData.map(row => row['Fecha_Hora']);
    const values = excelData.map(row => row['Vertimientos_PE_TCHAMMA']);

    if (labels.length === 0 || values.length === 0) {
      console.error("Error: No se encontraron datos en las columnas esperadas.");
      console.log("Datos cargados:", excelData);
      alert("El archivo no tiene columnas 'Fecha_Hora' y 'Vertimientos_PE_TCHAMMA'.");
      return;
    }

    console.log("Etiquetas extraídas:", labels);
    console.log("Valores extraídos:", values);

    // Crear el gráfico
    const ctx = document.getElementById('chart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Vertimientos',
          data: values,
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 2,
          fill: false
        }]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Gráfico de Vertimientos'
          }
        },
        scales: {
          x: { title: { display: true, text: 'Fecha y Hora' } },
          y: { title: { display: true, text: 'Vertimientos' } }
        }
      }
    });
  } catch (err) {
    console.error("Error al generar el gráfico:", err);
    alert("Hubo un error al generar el gráfico.");
  }
});
